// Layer: Anime4K-v4.1-Upscale-GAN-x4-(UUL)-Conv-4x3x3x3
// Name: conv2dtf
// Inputs: ['MAIN']
// Output: conv2d_tf
@group(0) @binding(0) var MAIN_tex: texture_2d<f32>;
@group(0) @binding(1) var conv2d_tf_tex: texture_storage_2d<rgba16float, write>;

fn go_0(pos: vec2u, x_off: i32, y_off: i32) -> vec4f {
  return textureLoad(MAIN_tex, vec2i(i32(pos.x) + x_off, i32(pos.y) + y_off), 0);
}

@compute
@workgroup_size(8, 8)
fn computeMain(@builtin(global_invocation_id) pixel: vec3u) {
  // OOB check
  let dim_out: vec2u = textureDimensions(conv2d_tf_tex);
  if (pixel.x >= dim_out.x || pixel.y >= dim_out.y) {
    return;
  }
  
  var result: vec4f = vec4f(0.0);
  result += mat4x4<f32>(0.3533503, -0.22744901, -0.09641403, 0.049930546, 0.21601382, 0.121875964, -0.4066155, -0.029510869, -0.15896404, -0.26784295, 0.12444282, -0.091934755, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, -1, -1);
  result += mat4x4<f32>(-0.05173876, 0.5917674, -0.25219238, 0.36018333, 0.0018698558, -0.020742422, -0.19959457, -0.16152367, -0.3881654, -0.40024987, -0.007772714, -0.062565684, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, -1, 0);
  result += mat4x4<f32>(0.015751071, -0.22430539, -0.11680504, 0.17976198, 0.14656822, -0.24317218, 0.029603355, -0.058181264, 0.058493074, 0.5022527, 0.11102914, -0.009173853, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, -1, 1);
  result += mat4x4<f32>(-0.18293951, 0.5723565, 0.28864875, -0.49024883, 0.09118296, 0.33084247, -0.024498459, 0.44283792, 0.47181615, -0.017086344, -0.32055214, 0.56722766, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, 0, -1);
  result += mat4x4<f32>(0.32458597, -0.18757421, -0.32922122, -0.016391084, -0.1533236, 0.18488754, 0.27331817, 0.35373816, -0.01502724, 0.33746547, -0.37427562, -0.09936772, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, 0, 0);
  result += mat4x4<f32>(0.6233762, 0.010086638, 0.05501213, -0.38833693, 0.18467852, 0.47564793, 0.2687248, 0.4827469, -0.43817607, 0.25323167, 0.5397538, -0.12697968, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, 0, 1);
  result += mat4x4<f32>(0.29222447, -0.105247036, -0.14783503, -0.06417592, 0.17500208, 0.17491722, 0.12673122, 0.21052802, 0.013908459, -0.24594653, -0.19099778, -0.0023773864, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, 1, -1);
  result += mat4x4<f32>(-0.46258658, 0.25608945, 0.18290475, 0.38827166, 0.29616114, -0.34748495, -0.386308, -0.061988145, -0.0665722, -0.4120009, 0.14303757, -0.5645748, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, 1, 0);
  result += mat4x4<f32>(-0.14725077, -0.38539198, 0.5607759, -0.18968762, -0.45513886, -0.17619537, 0.20813458, 0.2897601, 0.23251435, 0.0005268595, 0.04932729, 0.016341167, 0.0, 0.0, 0.0, 0.0) * go_0(pixel.xy, 1, 1);
  result += vec4f(0.00301274, 0.015373737, 0.020866359, 0.012416287);
  textureStore(conv2d_tf_tex, pixel.xy, result);
}
